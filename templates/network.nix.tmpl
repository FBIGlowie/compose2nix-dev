{{- $runtime := .Runtime | printf "%s" -}}
{{- $labels := mapToRepeatedKeyValFlag "--label" .Labels -}}
systemd.services."create-{{$runtime}}-network-{{.Name}}" = {
  serviceConfig.Type = "oneshot";
  path = [ pkgs.{{$runtime}} ];
  {{- if eq $runtime "docker"}}
  script = ''
    {{.Runtime}} network inspect {{.Name}} || {{.Runtime}} network create {{.Name}}{{ $labels | join " "}}
  '';
  {{- else}}
  script = ''
    {{.Runtime}} network inspect {{.Name}} || {{.Runtime}} network create {{.Name}} --opt isolate=true{{ $labels | join " "}}
  '';
  {{- end}}
  {{- if .Containers}}
  wantedBy = [
    {{- range .Containers}}
    {{. | printf "%q"}}
    {{- end}}
  ];
  before = [
    {{- range .Containers}}
    {{. | printf "%q"}}
    {{- end}}
  ];
  {{- end}}
};